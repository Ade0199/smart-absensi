<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>AdeSosial X</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Segoe UI,Arial;
  background:#0b0b0f;
  color:#fff;
}
input,textarea,button{
  width:100%;
  padding:12px;
  margin-top:8px;
  border-radius:12px;
  border:none;
  outline:none;
}
button{
  background:linear-gradient(135deg,#0095f6,#00c6ff);
  color:#fff;
  font-weight:bold;
}
#loginPage{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  width:90%;
  max-width:360px;
  background:rgba(255,255,255,0.06);
  backdrop-filter:blur(20px);
  padding:24px;
  border-radius:20px;
  box-shadow:0 0 40px rgba(0,0,0,.5);
}
#app{display:none}

/* HEADER */
header{
  position:sticky;
  top:0;
  z-index:10;
  background:rgba(0,0,0,0.6);
  backdrop-filter:blur(20px);
  padding:14px 16px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid rgba(255,255,255,0.08);
}

/* NAV */
nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:rgba(0,0,0,0.7);
  backdrop-filter:blur(20px);
  display:flex;
  justify-content:space-around;
  padding:10px 0;
  border-top:1px solid rgba(255,255,255,0.08);
}
nav button{
  background:none;
  font-size:22px;
}

/* PAGE */
#page{
  padding:12px;
  margin-bottom:80px;
}

/* STORY */
.story-bar{
  display:flex;
  overflow-x:auto;
  gap:12px;
  padding-bottom:10px;
}
.story{
  text-align:center;
}
.story img{
  width:64px;
  height:64px;
  border-radius:50%;
  padding:3px;
  background:linear-gradient(135deg,#ff00ff,#ff9900);
}

/* POST */
.post{
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(16px);
  border-radius:18px;
  margin-bottom:14px;
  padding:12px;
  box-shadow:0 0 20px rgba(0,0,0,.4);
}
.post img{
  width:100%;
  border-radius:14px;
}
.user{
  display:flex;
  align-items:center;
  gap:10px;
  font-weight:bold;
}
.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#333;
  display:flex;
  justify-content:center;
  align-items:center;
}
.like-btn{
  background:none;
  color:#ff4d6d;
  font-size:18px;
}

/* COMMENT */
.comment{
  font-size:14px;
  opacity:.9;
  margin-top:4px;
}

/* FLOAT BTN */
.fab{
  position:fixed;
  bottom:90px;
  right:20px;
  width:56px;
  height:56px;
  border-radius:50%;
  font-size:28px;
}
</style>
</head>

<body>

<div id="loginPage">
  <div class="login-box">
    <h2 style="text-align:center">AdeSosial X</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()" style="background:#333">Daftar</button>
  </div>
</div>

<div id="app">
  <header>
    <b>AdeSosial X</b>
    <button onclick="logout()" style="background:red">Logout</button>
  </header>

  <div id="page"></div>

  <button class="fab" onclick="showFeed()">Ôºã</button>

  <nav>
    <button onclick="showFeed()">üè†</button>
    <button onclick="showChat()">üí¨</button>
    <button onclick="showProfile(auth.currentUser.email)">üë§</button>
  </nav>
</div>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyCRldMRUuy7NqIMbJUCKSbPUlFyXgREn4w",
  authDomain:"adesosial-x.firebaseapp.com",
  projectId:"adesosial-x"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* AUTH */
function login(){auth.signInWithEmailAndPassword(email.value,password.value).catch(e=>alert(e.message))}
function register(){auth.createUserWithEmailAndPassword(email.value,password.value).catch(e=>alert(e.message))}
function logout(){auth.signOut()}
auth.onAuthStateChanged(u=>{
  if(u){loginPage.style.display="none";app.style.display="block";showFeed()}
  else{app.style.display="none";loginPage.style.display="flex"}
});

/* FEED */
function showFeed(){
  page.innerHTML=`
    <div class="story-bar" id="stories"></div>
    <input type="file" id="storyFile">
    <button onclick="postStory()">Tambah Story</button>
    <input type="file" id="photo">
    <textarea id="caption" placeholder="Apa yang kamu pikirkan?"></textarea>
    <button onclick="post()">Posting</button>
    <div id="feed"></div>`;
  loadStories();
  loadFeed();
}

/* STORY */
function postStory(){
  const f=storyFile.files[0]; if(!f)return;
  const fd=new FormData();
  fd.append("file",f);
  fd.append("upload_preset","adesosial_unsigned");
  fetch("https://api.cloudinary.com/v1_1/da50sezv7/image/upload",{method:"POST",body:fd})
  .then(r=>r.json()).then(d=>{
    db.collection("stories").add({img:d.secure_url,user:auth.currentUser.email,time:Date.now()});
  });
}
function loadStories(){
  const limit=Date.now()-86400000;
  db.collection("stories").where("time",">",limit)
  .onSnapshot(s=>{
    stories.innerHTML="";
    s.forEach(d=>{
      const st=d.data();
      stories.innerHTML+=`<div class="story"><img src="${st.img}"></div>`;
    });
  });
}

/* POST */
function post(){
  const f=photo.files[0]; if(!f)return;
  const fd=new FormData();
  fd.append("file",f);
  fd.append("upload_preset","adesosial_unsigned");
  fetch("https://api.cloudinary.com/v1_1/da50sezv7/image/upload",{method:"POST",body:fd})
  .then(r=>r.json()).then(d=>{
    db.collection("posts").add({
      img:d.secure_url,
      caption:caption.value,
      user:auth.currentUser.email,
      likes:0,
      time:Date.now()
    });
    caption.value="";
  });
}
function loadFeed(){
  db.collection("posts").orderBy("time","desc").onSnapshot(s=>{
    feed.innerHTML="";
    s.forEach(doc=>{
      const p=doc.data();
      feed.innerHTML+=`
      <div class="post">
        <div class="user">
          <div class="avatar">${p.user[0].toUpperCase()}</div>
          @${p.user}
        </div>
        <img src="${p.img}">
        <p>${p.caption}</p>
        <button class="like-btn" onclick="like('${doc.id}',${p.likes})">‚ù§Ô∏è ${p.likes}</button>
        <div id="c-${doc.id}"></div>
        <input placeholder="Komentar..." onkeydown="addComment(event,'${doc.id}')">
      </div>`;
      loadComments(doc.id);
    });
  });
}
function like(id,c){db.collection("posts").doc(id).update({likes:c+1})}

/* COMMENT */
function addComment(e,id){
  if(e.key==="Enter"){
    db.collection("posts").doc(id).collection("comments")
    .add({user:auth.currentUser.email,text:e.target.value,time:Date.now()});
    e.target.value="";
  }
}
function loadComments(id){
  db.collection("posts").doc(id).collection("comments").orderBy("time")
  .onSnapshot(s=>{
    const box=document.getElementById("c-"+id);
    box.innerHTML="";
    s.forEach(d=>{
      const c=d.data();
      box.innerHTML+=`<div class="comment"><b>${c.user}</b> ${c.text}</div>`;
    });
  });
}

/* CHAT */
function showChat(){
  page.innerHTML=`<h3>Chat Realtime</h3><div id="chat"></div>`;
}
function showProfile(u){
  page.innerHTML=`<h3>@${u}</h3>`;
}
</script>
</body>
</html>
