<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>AdeSosial X</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<!-- Firebase CDN (COMPAT ‚Äì AMAN) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
}

/* ===== LOGIN ===== */
#loginPage{
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}

.login-box{
  background:#111;
  padding:30px;
  width:100%;
  max-width:350px;
  border-radius:16px;
  box-shadow:0 0 30px rgba(0,0,0,.6);
}

.login-box h1{
  text-align:center;
  margin-bottom:20px;
}

input,textarea,button{
  width:100%;
  padding:12px;
  margin:6px 0;
  border-radius:10px;
  border:none;
  outline:none;
}

button{
  font-weight:bold;
  cursor:pointer;
}

.btn-login{background:#00c6ff;color:#000}
.btn-register{background:#00ff99;color:#000}

/* ===== APP ===== */
#app{
  display:none;
}

header{
  padding:15px;
  text-align:center;
  font-size:20px;
  background:#000;
}

.container{padding:10px}

.post{
  background:#1b1b1b;
  padding:10px;
  border-radius:14px;
  margin-bottom:10px;
}

.post img{
  width:100%;
  border-radius:10px;
}

.like{
  color:#00c6ff;
  cursor:pointer;
}
</style>
</head>

<body>

<!-- ================= LOGIN PAGE ================= -->
<div id="loginPage">
  <div class="login-box">
    <h1>AdeSosial X</h1>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button class="btn-login" onclick="login()">Login</button>
    <button class="btn-register" onclick="register()">Daftar</button>
  </div>
</div>

<!-- ================= APP ================= -->
<div id="app">
  <header>AdeSosial X üî•</header>
  <div class="container">
    <input type="file" id="photo">
    <textarea id="caption" placeholder="Tulis sesuatu..."></textarea>
    <button onclick="post()">Posting</button>

    <h3>Feed</h3>
    <div id="feed"></div>
  </div>
</div>

<script>
/* ================= FIREBASE INIT ================= */
firebase.initializeApp({
  apiKey: "AIzaSyCRldMRUuy7NqIMbJUCKSbPUlFyXgREn4w",
  authDomain: "adesosial-x.firebaseapp.com",
  projectId: "adesosial-x",
  storageBucket: "adesosial-x.firebasestorage.app",
  messagingSenderId: "549966673845",
  appId: "1:549966673845:web:d85794b0d840d2209e0bfc"
});

const firebaseAuth = firebase.auth();
const db = firebase.firestore();
const storage = firebase.storage();

/* ================= AUTH ================= */
function login(){
  firebaseAuth.signInWithEmailAndPassword(email.value,password.value)
  .catch(err=>alert(err.message));
}

function register(){
  firebaseAuth.createUserWithEmailAndPassword(email.value,password.value)
  .catch(err=>alert(err.message));
}

firebaseAuth.onAuthStateChanged(user=>{
  if(user){
    loginPage.style.display="none";
    app.style.display="block";
  }
});

/* ================= POST ================= */
async function post(){
  if(!firebaseAuth.currentUser) return alert("Login dulu");

  const file = photo.files[0];
  if(!file) return alert("Pilih foto");

  const ref = storage.ref("posts/"+Date.now());
  await ref.put(file);
  const url = await ref.getDownloadURL();

  await db.collection("posts").add({
    user: firebaseAuth.currentUser.email,
    img: url,
    caption: caption.value,
    likes: 0,
    time: firebase.firestore.FieldValue.serverTimestamp()
  });

  caption.value="";
}

/* ================= FEED REALTIME ================= */
db.collection("posts")
.orderBy("time","desc")
.onSnapshot(snap=>{
  feed.innerHTML="";
  snap.forEach(doc=>{
    const p = doc.data();
    feed.innerHTML += `
      <div class="post">
        <img src="${p.img}">
        <p><b>${p.user}</b></p>
        <p>${p.caption}</p>
        <p class="like" onclick="likePost('${doc.id}',${p.likes})">
          ‚ù§Ô∏è ${p.likes}
        </p>
      </div>
    `;
  });
});

/* ================= LIKE ================= */
function likePost(id,likes){
  db.collection("posts").doc(id).update({
    likes: likes + 1
  });
}

/* ================= PWA ================= */
if("serviceWorker" in navigator){
  navigator.serviceWorker.register("service-worker.js");
}
</script>

</body>
</html>
