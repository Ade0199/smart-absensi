<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>AdeSosial X</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Arial,Helvetica,sans-serif;
  background:#000;
  color:#fff;
}
input,textarea,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:none;
}
button{
  background:#0095f6;
  color:#fff;
  font-weight:bold;
}
#loginPage{
  height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
}
.login-box{
  width:90%;
  max-width:360px;
  background:#111;
  padding:20px;
  border-radius:12px;
}
#app{display:none}
header{
  background:#000;
  padding:12px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #222;
}
nav{
  position:fixed;
  bottom:0;
  width:100%;
  background:#000;
  display:flex;
  justify-content:space-around;
  border-top:1px solid #222;
}
nav button{
  background:none;
  font-size:20px;
}
#page{
  padding:10px;
  margin-bottom:70px;
}
.post{
  background:#111;
  margin-bottom:12px;
  border-radius:12px;
  padding:10px;
}
.post img{
  width:100%;
  border-radius:10px;
}
.like-btn{
  background:none;
  color:#ff4444;
  font-size:18px;
}
</style>
</head>

<body>

<!-- LOGIN -->
<div id="loginPage">
  <div class="login-box">
    <h2 style="text-align:center">AdeSosial X</h2>
    <input id="email" placeholder="Email">
    <input id="password" type="password" placeholder="Password">
    <button onclick="login()">Login</button>
    <button onclick="register()" style="background:#333">Daftar</button>
  </div>
</div>

<!-- APP -->
<div id="app">
  <header>
    <b>AdeSosial X</b>
    <button onclick="logout()" style="background:red">Logout</button>
  </header>

  <div id="page"></div>

  <nav>
    <button onclick="showFeed()">üè†</button>
    <button onclick="alert('Chat V3')">üí¨</button>
    <button onclick="alert('Story V6')">üì∏</button>
    <button onclick="alert('Notif V7')">üîî</button>
  </nav>
</div>

<script>
/* FIREBASE */
firebase.initializeApp({
  apiKey: "AIzaSyCRldMRUuy7NqIMbJUCKSbPUlFyXgREn4w",
  authDomain: "adesosial-x.firebaseapp.com",
  projectId: "adesosial-x"
});

const auth = firebase.auth();
const db = firebase.firestore();

/* AUTH */
function login(){
  auth.signInWithEmailAndPassword(email.value,password.value)
  .catch(e=>alert(e.message));
}
function register(){
  auth.createUserWithEmailAndPassword(email.value,password.value)
  .catch(e=>alert(e.message));
}
function logout(){auth.signOut();}

auth.onAuthStateChanged(user=>{
  if(user){
    loginPage.style.display="none";
    app.style.display="block";
    showFeed();
  }else{
    app.style.display="none";
    loginPage.style.display="flex";
  }
});

/* FEED */
function showFeed(){
  page.innerHTML=`
    <input type="file" id="photo">
    <textarea id="caption" placeholder="Apa yang kamu pikirkan?"></textarea>
    <button onclick="post()">Posting</button>
    <div id="feed"></div>
  `;
  loadFeed();
}

function post(){
  const file=photo.files[0];
  if(!file) return alert("Pilih foto");

  const fd=new FormData();
  fd.append("file",file);
  fd.append("upload_preset","adesosial_unsigned");

  fetch("https://api.cloudinary.com/v1_1/da50sezv7/image/upload",{
    method:"POST",body:fd
  }).then(r=>r.json()).then(d=>{
    db.collection("posts").add({
      img:d.secure_url,
      caption:caption.value,
      user:auth.currentUser.email,
      likes:0,
      time:firebase.firestore.FieldValue.serverTimestamp()
    });
    caption.value="";
  });
}

function loadFeed(){
  db.collection("posts")
  .orderBy("time","desc")
  .onSnapshot(snap=>{
    feed.innerHTML="";
    snap.forEach(doc=>{
      const p=doc.data();
      feed.innerHTML+=`
        <div class="post">
          <img src="${p.img}">
          <p><b>${p.user}</b></p>
          <p>${p.caption}</p>
          <button class="like-btn" onclick="like('${doc.id}',${p.likes})">‚ù§Ô∏è ${p.likes}</button>
        </div>
      `;
    });
  });
}

function like(id,count){
  db.collection("posts").doc(id).update({likes:count+1});
}
</script>
</body>
</html>
